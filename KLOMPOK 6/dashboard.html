<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameHub - Dashboard</title>
    <link rel="stylesheet" href="stylekedua.css">
</head>
<body class="dashboard-page">
    <!-- Efek Visual -->
    <div class="stars-container"></div>
    <div class="lightning-container"></div>
    <div class="lightning-flash"></div>
    <div id="realLightningContainer"></div>
    
    <!-- Header Bagian Dashboard -->
    <header>
        <div class="container">
            <nav>
        <div class="logo-group">
            <img src="image/maloetta.png" alt="GameHub Logo" class="logo-img">
        <div class="logo">GameHub</div>
        </div>
            <ul class="nav-links">
            <li><a href="login.html" onclick="logout()">Keluar</a></li>
            <li><a href="#profil" onclick="showProfile()">Profil</a></li>
            </ul>
            </nav>
        </div>
    </header>

    <!-- Konten Utama -->
    <section class="main-content container">
        <div class="welcome-section">
            <h1>Selamat Datang di GameHub, <span id="userGreeting">Pengguna</span>!</h1>
            <p>Temukan game terbaik dan berikan review Anda!</p>
        </div>

        <!-- Filter dan Pencarian -->
        <div class="filter-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Cari game..." onkeyup="searchGames()">
            </div>
            <div class="category-filter">
                <select id="categorySelect" onchange="filterGames()">
                    <option value="all">Genres</option>
                    <option value="action">Action</option>
                    <option value="adventure">Adventure</option>
                    <option value="rpg">RPG (Role-Playing Game)</option>
                    <option value="strategy">Strategy</option>
                    <option value="sports">Sports</option>
                    <option value="arcade">Arcade</option>
                    <option value="comedy">Comedy</option>
                    <option value="fantasy">Fantasy</option>
                    <option value="horror">Horror</option>
                    <option value="mystery">Mystery</option>
                    <option value="puzzle">Puzzle</option>
                    <option value="romance">Romance</option>
                    <option value="survival">Survival</option>
                    <option value="simulation">Simulation</option>
                    <option value="cozy">Cozy</option>
                    <option value="music">Music</option>
                    <option value="battle royal">Battle Royal</option>
                    <option value="mmorpg">MMORPG (Massively Multiplayer Online RPG)</option>
                </select>
            </div>
        </div>

        <!-- Hasil Pencarian -->
        <div id="searchResults" class="search-results" style="display: none;">
            <h3>Hasil Pencarian</h3>
            <div id="searchResultsList" class="game-list"></div>
        </div>

        <!-- Daftar Game -->
        <div id="gameListSection">
            <div class="game-list" id="gameList">
                <!-- Game cards akan diisi oleh JavaScript -->
            </div>
        </div>
    </section>

    <!-- Modal Review -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeReviewModal()">&times;</span>
            <h2>Beri Review untuk <span id="reviewGameTitle">Game Title</span></h2>
            <form id="reviewForm">
                <input type="hidden" id="reviewGameId">
                <div class="rating-input">
                    <label>Rating:</label>
                    <div class="star-rating">
                        <input type="radio" id="star5" name="rating" value="5">
                        <label for="star5">&#9733;</label>
                        <input type="radio" id="star4" name="rating" value="4">
                        <label for="star4">&#9733;</label>
                        <input type="radio" id="star3" name="rating" value="3">
                        <label for="star3">&#9733;</label>
                        <input type="radio" id="star2" name="rating" value="2">
                        <label for="star2">&#9733;</label>
                        <input type="radio" id="star1" name="rating" value="1">
                        <label for="star1">&#9733;</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="review-text">Review Anda:</label>
                    <textarea id="review-text" class="review-text" placeholder="Tulis review Anda di sini..." required></textarea>
                </div>
                <button type="submit" class="btn">Kirim Review</button>
            </form>
        </div>
    </div>

    <!-- Modal Profil -->
    <div id="profileModal" class="modal">
        <div class="modal-content profile-modal">
            <span class="close-modal" onclick="closeProfile()">&times;</span>
            <h2>Profil Pengguna</h2>
            <div class="profile-info">
                <div class="profile-avatar">
                    <div class="avatar-placeholder">ðŸ‘¤</div>
                </div>
                <div class="profile-details">
                    <div class="detail-item">
                        <label>Nama:</label>
                        <span id="profileName">-</span>
                    </div>
                    <div class="detail-item">
                        <label>Email:</label>
                        <span id="profileEmail">-</span>
                    </div>
                    <div class="detail-item">
                        <label>Username:</label>
                        <span id="profileUsername">-</span>
                    </div>
                </div>
            </div>
            <div class="profile-actions">
                <button class="btn btn-secondary" onclick="showChangePassword()">Ubah Password</button>
            </div>
            <div class="rated-games-section">
                <h3>Game yang Sudah Di-rating</h3>
                <div id="ratedGamesList" class="rated-games-list">
                    <p class="no-data">Belum ada game yang di-rating</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ubah Password -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeChangePassword()">&times;</span>
            <h2>Ubah Password</h2>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label for="currentPassword">Password Saat Ini</label>
                    <input type="password" id="currentPassword" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">Password Baru</label>
                    <input type="password" id="newPassword" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Konfirmasi Password Baru</label>
                    <input type="password" id="confirmPassword" required>
                </div>
                <button type="submit" class="btn">Simpan Perubahan</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">GameHub</div>
                <ul class="footer-links">
                    <li><a href="#tentang">Tentang Kami</a></li>
                    <li><a href="#privasi">Kebijakan Privasi</a></li>
                    <li><a href="#syarat">Syarat dan Ketentuan</a></li>
                    <li><a href="#kontak">Kontak</a></li>
                </ul>
                <p class="copyright">&copy; 2023 GameHub. Semua hak dilindungi.</p>
            </div>
        </div>
    </footer>

    <script>
        // Data game
        const games = [
            {
                id: 1,
                title: "The Witcher 3: Wild Hunt",
                category: "rpg",
                image: "https://images.igdb.com/igdb/image/upload/t_cover_big/co2rry.jpg",
                description: "Game RPG epik dengan dunia terbuka yang luas dan cerita yang mendalam.",
                defaultRating: 4.8
            },
            {
                id: 2,
                title: "Cyberpunk 2077",
                category: "rpg",
                image: "https://images.igdb.com/igdb/image/upload/t_cover_big/co2x8j.jpg",
                description: "Petualangan futuristik di kota Night City yang penuh dengan kejahatan dan teknologi.",
                defaultRating: 3.9
            },
            {
                id: 3,
                title: "Red Dead Redemption 2",
                category: "adventure",
                image: "https://images.igdb.com/igdb/image/upload/t_cover_big/co1wyy.jpg",
                description: "Kisah epik kehidupan koboi di Amerika pada akhir abad ke-19.",
                defaultRating: 4.7
            },
            {
                id: 4,
                title: "Call of Duty: Warzone",
                category: "action",
                image: "https://images.igdb.com/igdb/image/upload/t_cover_big/co4k7d.jpg",
                description: "Battle royale intens dengan pertempuran 150 pemain di peta yang luas.",
                defaultRating: 4.2
            },
            {
                id: 5,
                title: "FIFA 23",
                category: "sports",
                image: "https://images.igdb.com/igdb/image/upload/t_cover_big/co5x74.jpg",
                description: "Simulasi sepak bola terbaru dengan grafis dan gameplay yang ditingkatkan.",
                defaultRating: 4.0
            },
            {
                id: 6,
                title: "Civilization VI",
                category: "strategy",
                image: "https://images.igdb.com/igdb/image/upload/t_cover_big/co1t2p.jpg",
                description: "Game strategi turn-based di mana Anda membangun peradaban dari awal.",
                defaultRating: 4.5
            }
        ];

        let currentUser = JSON.parse(localStorage.getItem('gamehub_current_user')) || null;
        let userRatings = JSON.parse(localStorage.getItem('gamehub_ratings')) || {};

        // ==================== EFEK VISUAL ====================

        // Fungsi untuk membuat efek petir
        function createLightning() {
            const lightningContainer = document.querySelector('.lightning-container');
            const lightningFlash = document.querySelector('.lightning-flash');
            
            if (lightningContainer && lightningFlash) {
                // Reset container
                lightningContainer.innerHTML = '';
                
                // Buat beberapa petir dengan posisi acak
                const lightningCount = 1 + Math.floor(Math.random() * 3);
                
                for (let i = 0; i < lightningCount; i++) {
                    const lightning = document.createElement('div');
                    lightning.classList.add('lightning');
                    
                    // Atur posisi acak
                    const left = 10 + Math.random() * 80;
                    const height = 30 + Math.random() * 50;
                    
                    lightning.style.left = `${left}%`;
                    lightning.style.height = `${height}%`;
                    
                    lightningContainer.appendChild(lightning);
                }
                
                // Aktifkan efek kilatan
                lightningFlash.classList.add('active');
                setTimeout(() => {
                    lightningFlash.classList.remove('active');
                }, 300);
                
                // Hapus petir setelah animasi selesai
                setTimeout(() => {
                    lightningContainer.innerHTML = '';
                }, 1000);
            }
        }

        // Fungsi untuk membuat petir realistis dengan cabang-cabang
        function createRealisticLightning() {
            const container = document.getElementById('realLightningContainer');
            if (!container) return;
            
            // Hapus petir lama
            container.innerHTML = '';
            
            // Buat elemen petir utama
            const lightning = document.createElement('div');
            lightning.className = 'real-lightning';
            
            // Posisi acak untuk petir
            const startX = 20 + Math.random() * 60;
            const startY = 10;
            const endY = 80 + Math.random() * 15;
            
            // Buat SVG untuk petir dengan path yang kompleks
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.setAttribute("viewBox", "0 0 100 100");
            svg.style.position = "absolute";
            svg.style.top = "0";
            svg.style.left = "0";
            svg.style.pointerEvents = "none";
            
            // Buat path utama petir dengan bentuk zigzag yang realistis
            const mainPath = document.createElementNS(svgNS, "path");
            let pathData = `M ${startX} ${startY} `;
            
            let currentX = startX;
            let currentY = startY;
            const segments = 8 + Math.floor(Math.random() * 6);
            
            for (let i = 0; i < segments; i++) {
                const segmentLength = 5 + Math.random() * 8;
                const direction = Math.random() > 0.5 ? 1 : -1;
                const bend = 3 + Math.random() * 4;
                
                const nextX = currentX + (direction * bend);
                const nextY = currentY + segmentLength;
                
                // Kontrol titik untuk kurva Bezier yang lebih natural
                const controlX1 = currentX + (direction * bend * 0.3);
                const controlY1 = currentY + segmentLength * 0.3;
                const controlX2 = currentX + (direction * bend * 0.7);
                const controlY2 = currentY + segmentLength * 0.7;
                
                pathData += `C ${controlX1} ${controlY1}, ${controlX2} ${controlY2}, ${nextX} ${nextY} `;
                
                currentX = nextX;
                currentY = nextY;
                
                // Hentikan jika sudah mencapai bagian bawah
                if (currentY >= endY) break;
            }
            
            mainPath.setAttribute("d", pathData);
            mainPath.setAttribute("fill", "none");
            mainPath.setAttribute("stroke", "#ffffff");
            mainPath.setAttribute("stroke-width", "1.5");
            mainPath.setAttribute("stroke-linecap", "round");
            mainPath.setAttribute("stroke-linejoin", "round");
            mainPath.style.filter = "url(#lightning-glow)";
            
            // Buat cabang-cabang petir
            const branches = 3 + Math.floor(Math.random() * 4);
            for (let i = 0; i < branches; i++) {
                setTimeout(() => {
                    const branch = createLightningBranch(startX, startY, endY);
                    svg.appendChild(branch);
                }, Math.random() * 100);
            }
            
            // Filter untuk efek glow
            const defs = document.createElementNS(svgNS, "defs");
            const filter = document.createElementNS(svgNS, "filter");
            filter.setAttribute("id", "lightning-glow");
            filter.setAttribute("x", "-50%");
            filter.setAttribute("y", "-50%");
            filter.setAttribute("width", "200%");
            filter.setAttribute("height", "200%");
            
            const feGaussianBlur = document.createElementNS(svgNS, "feGaussianBlur");
            feGaussianBlur.setAttribute("in", "SourceGraphic");
            feGaussianBlur.setAttribute("stdDeviation", "2");
            feGaussianBlur.setAttribute("result", "blur");
            
            const feColorMatrix = document.createElementNS(svgNS, "feColorMatrix");
            feColorMatrix.setAttribute("in", "blur");
            feColorMatrix.setAttribute("type", "matrix");
            feColorMatrix.setAttribute("values", "1 0 0 0 0  0 1 0 0 0.8  0 0 1 0 0.9  0 0 0 1 0");
            feColorMatrix.setAttribute("result", "coloredBlur");
            
            const feMerge = document.createElementNS(svgNS, "feMerge");
            const feMergeNode1 = document.createElementNS(svgNS, "feMergeNode");
            feMergeNode1.setAttribute("in", "coloredBlur");
            const feMergeNode2 = document.createElementNS(svgNS, "feMergeNode");
            feMergeNode2.setAttribute("in", "SourceGraphic");
            
            feMerge.appendChild(feMergeNode1);
            feMerge.appendChild(feMergeNode2);
            
            filter.appendChild(feGaussianBlur);
            filter.appendChild(feColorMatrix);
            filter.appendChild(feMerge);
            defs.appendChild(filter);
            
            svg.appendChild(defs);
            svg.appendChild(mainPath);
            lightning.appendChild(svg);
            container.appendChild(lightning);
            
            // Animasi kilat
            setTimeout(() => {
                lightning.style.opacity = '1';
            }, 10);
            
            // Hapus setelah animasi selesai
            setTimeout(() => {
                if (lightning.parentNode) {
                    lightning.parentNode.removeChild(lightning);
                }
            }, 800);
            
            // Efek flash
            const flash = document.createElement('div');
            flash.className = 'lightning-flash-real';
            container.appendChild(flash);
            
            setTimeout(() => {
                if (flash.parentNode) {
                    flash.parentNode.removeChild(flash);
                }
            }, 600);
        }
        
        function createLightningBranch(startX, startY, endY) {
            const svgNS = "http://www.w3.org/2000/svg";
            const branch = document.createElementNS(svgNS, "path");
            
            const branchStartX = startX + (Math.random() * 20 - 10);
            const branchStartY = startY + 10 + Math.random() * 30;
            const branchEndY = endY - 10 - Math.random() * 20;
            
            let pathData = `M ${branchStartX} ${branchStartY} `;
            
            let currentX = branchStartX;
            let currentY = branchStartY;
            const segments = 4 + Math.floor(Math.random() * 3);
            
            for (let i = 0; i < segments; i++) {
                const segmentLength = 3 + Math.random() * 5;
                const direction = Math.random() > 0.5 ? 1 : -1;
                const bend = 2 + Math.random() * 3;
                
                const nextX = currentX + (direction * bend);
                const nextY = currentY + segmentLength;
                
                pathData += `L ${nextX} ${nextY} `;
                
                currentX = nextX;
                currentY = nextY;
                
                if (currentY >= branchEndY) break;
            }
            
            branch.setAttribute("d", pathData);
            branch.setAttribute("fill", "none");
            branch.setAttribute("stroke", "#a8d0ff");
            branch.setAttribute("stroke-width", "0.8");
            branch.setAttribute("stroke-linecap", "round");
            branch.setAttribute("stroke-linejoin", "round");
            branch.style.filter = "url(#lightning-glow)";
            
            return branch;
        }

        // Fungsi untuk membuat bintang segi lima
        function createStarShape() {
            const star = document.createElement('div');
            star.classList.add('star-shape');
            
            // Buat elemen untuk setiap titik bintang
            for (let i = 0; i < 5; i++) {
                const point = document.createElement('div');
                point.classList.add('star-point');
                star.appendChild(point);
            }
            
            return star;
        }

        // Fungsi untuk membuat bintang berjatuhan
        function createStars() {
            const starsContainer = document.querySelector('.stars-container');
            if (!starsContainer) return;
            
            // Hapus bintang lama jika ada
            starsContainer.innerHTML = '';
            
            // Buat bintang baru (jumlah bintang disesuaikan dengan ukuran layar)
            const starCount = Math.floor(window.innerWidth / 30);
            
            for (let i = 0; i < starCount; i++) {
                const star = createStarShape();
                
                // Atur posisi dan animasi acak untuk setiap bintang
                const left = Math.random() * 100;
                const delay = Math.random() * 20;
                const duration = 5 + Math.random() * 10;
                const size = 5 + Math.random() * 10;
                const opacity = 0.3 + Math.random() * 0.7;
                
                star.style.left = `${left}%`;
                star.style.animationDelay = `${delay}s`;
                star.style.animationDuration = `${duration}s`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.opacity = opacity;
                
                starsContainer.appendChild(star);
            }
        }

        // ==================== FUNGSI APLIKASI ====================

        // Fungsi logout
        function logout() {
            localStorage.removeItem('gamehub_current_user');
            currentUser = null;
        }

        // Fungsi untuk menampilkan game
        function displayGames(gamesToShow = games) {
            const gameList = document.getElementById('gameList');
            gameList.innerHTML = gamesToShow.map(game => {
                const userRatingKey = currentUser ? `${currentUser.username}_ratings` : '';
                const userGameRating = userRatings[userRatingKey]?.find(r => r.gameId === game.id);
                const hasUserRated = !!userGameRating;
                
                return `
                    <div class="game-card" data-game-id="${game.id}">
                        <img src="${game.image}" alt="${game.title}" class="game-image">
                        <div class="game-info">
                            <h3 class="game-title">${game.title}</h3>
                            <span class="game-category">${game.category.toUpperCase()}</span>
                            <p class="game-description">${game.description}</p>
                            <div class="game-rating">
                                <div class="stars">${'â˜…'.repeat(Math.floor(game.defaultRating))}${'â˜†'.repeat(5-Math.floor(game.defaultRating))}</div>
                                <span>${game.defaultRating}/5.0</span>
                            </div>
                            ${hasUserRated ? `
                                <div class="user-rating">
                                    <div class="your-rating">Rating Anda: ${'â˜…'.repeat(userGameRating.rating)}${'â˜†'.repeat(5-userGameRating.rating)}</div>
                                    <button class="review-btn" onclick="editReview(${game.id})">Edit Review</button>
                                </div>
                            ` : `
                                <button class="review-btn" onclick="openReviewModal(${game.id})">Beri Review</button>
                            `}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Fungsi pencarian game
        function searchGames() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categorySelect').value;
            const searchResults = document.getElementById('searchResults');
            const searchResultsList = document.getElementById('searchResultsList');
            const gameListSection = document.getElementById('gameListSection');

            if (searchTerm === '') {
                searchResults.style.display = 'none';
                gameListSection.style.display = 'block';
                displayGames();
                return;
            }

            const filteredGames = games.filter(game => {
                const matchesSearch = game.title.toLowerCase().includes(searchTerm);
                const matchesCategory = category === 'all' || game.category === category;
                return matchesSearch && matchesCategory;
            });

            if (filteredGames.length === 0) {
                searchResultsList.innerHTML = '<p class="no-results">Game tidak ditemukan</p>';
            } else {
                searchResultsList.innerHTML = filteredGames.map(game => `
                    <div class="game-card" data-game-id="${game.id}">
                        <img src="${game.image}" alt="${game.title}" class="game-image">
                        <div class="game-info">
                            <h3 class="game-title">${game.title}</h3>
                            <span class="game-category">${game.category.toUpperCase()}</span>
                            <p class="game-description">${game.description}</p>
                            <div class="game-rating">
                                <div class="stars">${'â˜…'.repeat(Math.floor(game.defaultRating))}${'â˜†'.repeat(5-Math.floor(game.defaultRating))}</div>
                                <span>${game.defaultRating}/5.0</span>
                            </div>
                            <button class="review-btn" onclick="openReviewModal(${game.id})">Beri Review</button>
                        </div>
                    </div>
                `).join('');
            }

            searchResults.style.display = 'block';
            gameListSection.style.display = 'none';
        }

        // Fungsi filter berdasarkan kategori
        function filterGames() {
            const category = document.getElementById('categorySelect').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (searchTerm !== '') {
                searchGames();
                return;
            }

            if (category === 'all') {
                displayGames();
            } else {
                const filteredGames = games.filter(game => game.category === category);
                displayGames(filteredGames);
            }
        }

        // Fungsi modal review
        function openReviewModal(gameId) {
            if (!currentUser) {
                alert('Silakan login terlebih dahulu!');
                window.location.href = 'login.html';
                return;
            }

            const game = games.find(g => g.id === gameId);
            document.getElementById('reviewGameTitle').textContent = game.title;
            document.getElementById('reviewGameId').value = gameId;
            
            // Cek jika user sudah memberikan rating
            const userRatingKey = `${currentUser.username}_ratings`;
            const existingRating = userRatings[userRatingKey]?.find(r => r.gameId === gameId);
            
            if (existingRating) {
                document.querySelector(`input[name="rating"][value="${existingRating.rating}"]`).checked = true;
                document.getElementById('review-text').value = existingRating.review || '';
            } else {
                document.querySelectorAll('input[name="rating"]').forEach(radio => radio.checked = false);
                document.getElementById('review-text').value = '';
            }
            
            document.getElementById('reviewModal').style.display = 'block';
        }

        function closeReviewModal() {
            document.getElementById('reviewModal').style.display = 'none';
        }

        function editReview(gameId) {
            openReviewModal(gameId);
        }

        // Fungsi profil
        function showProfile() {
            if (!currentUser) {
                alert('Silakan login terlebih dahulu');
                window.location.href = 'login.html';
                return;
            }
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('profileUsername').textContent = currentUser.username;
            updateRatedGamesList();
            document.getElementById('profileModal').style.display = 'block';
        }

        function closeProfile() {
            document.getElementById('profileModal').style.display = 'none';
        }

        function showChangePassword() {
            closeProfile();
            document.getElementById('changePasswordModal').style.display = 'block';
        }

        function closeChangePassword() {
            document.getElementById('changePasswordModal').style.display = 'none';
        }

        function updateRatedGamesList() {
            const ratedGamesList = document.getElementById('ratedGamesList');
            const userRatingKey = `${currentUser.username}_ratings`;
            const ratings = userRatings[userRatingKey] || [];
            
            if (ratings.length === 0) {
                ratedGamesList.innerHTML = '<p class="no-data">Belum ada game yang di-rating</p>';
                return;
            }
            
            ratedGamesList.innerHTML = ratings.map(rating => {
                const game = games.find(g => g.id === rating.gameId);
                return `
                    <div class="rated-game-item">
                        <div class="game-title">${game.title}</div>
                        <div class="game-rating">Rating: ${'â˜…'.repeat(rating.rating)}${'â˜†'.repeat(5-rating.rating)}</div>
                        <div class="review-preview">${rating.review || 'Tidak ada review'}</div>
                    </div>
                `;
            }).join('');
        }

        // Event Listeners
        document.getElementById('reviewForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const gameId = parseInt(document.getElementById('reviewGameId').value);
            const rating = parseInt(document.querySelector('input[name="rating"]:checked').value);
            const review = document.getElementById('review-text').value;

            const userRatingKey = `${currentUser.username}_ratings`;
            if (!userRatings[userRatingKey]) {
                userRatings[userRatingKey] = [];
            }

            const existingRatingIndex = userRatings[userRatingKey].findIndex(r => r.gameId === gameId);
            const game = games.find(g => g.id === gameId);

            if (existingRatingIndex !== -1) {
                userRatings[userRatingKey][existingRatingIndex] = { gameId, gameTitle: game.title, rating, review };
            } else {
                userRatings[userRatingKey].push({ gameId, gameTitle: game.title, rating, review });
            }

            localStorage.setItem('gamehub_ratings', JSON.stringify(userRatings));
            alert('Review berhasil disimpan!');
            closeReviewModal();
            displayGames();
        });

        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (currentPassword !== currentUser.password) {
                alert('Password saat ini salah!');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('Konfirmasi password tidak sesuai!');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('gamehub_users')) || [];
            currentUser.password = newPassword;
            const userIndex = users.findIndex(u => u.username === currentUser.username);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('gamehub_users', JSON.stringify(users));
                localStorage.setItem('gamehub_current_user', JSON.stringify(currentUser));
                alert('Password berhasil diubah!');
                closeChangePassword();
                
                // Reset form
                document.getElementById('changePasswordForm').reset();
            }
        });

        // ==================== INISIALISASI ====================

        // Jalankan efek saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }

            // Update greeting
            document.getElementById('userGreeting').textContent = currentUser.name;
            
            displayGames();
            
            // ========== EFEK VISUAL ==========
            // Buat efek bintang
            createStars();
            
            // Atur interval untuk efek petir (setiap 8-15 detik)
            setInterval(() => {
                if (Math.random() > 0.6) { // 40% kemungkinan petir muncul
                    createLightning();
                }
            }, 8000);
            
            // Atur interval untuk efek petir realistis (setiap 4-8 detik)
            setInterval(() => {
                createRealisticLightning();
            }, 4000 + Math.random() * 4000);
            
            // Buat ulang bintang saat ukuran jendela berubah
            window.addEventListener('resize', createStars);
            
            // Tambahkan petir sekali saat halaman dimuat
            setTimeout(() => {
                createLightning();
                createRealisticLightning();
            }, 2000);
        });
    </script>
</body>
</html>